# åˆè§„æ€§æ–‡æ¡£

æœ¬æ–‡æ¡£è¯´æ˜çˆ¬è™«å¦‚ä½•éµå®ˆç½‘ç«™è§„åˆ™ã€æ³•å¾‹æ³•è§„å’Œé“å¾·å‡†åˆ™ã€‚

## 1. Robots.txt åˆè§„æ€§

### 1.1 Robots.txt å†…å®¹

```
User-agent: *
Disallow: /*?*
Disallow: /?*
Disallow: /reg/
Disallow: /login*
Disallow: /ot/
Disallow: /uc*
```

**æ¥æº**: https://m.ydl.com/robots.txt  
**æ£€æŸ¥æ—¶é—´**: 2025-11-03

### 1.2 åˆè§„åˆ†æ

| è·¯å¾„ | è§„åˆ™ | æœ¬çˆ¬è™«è¡Œä¸º | åˆè§„æ€§ |
|------|------|-----------|--------|
| `/ask` | æœªç¦æ­¢ | âœ… è®¿é—® | âœ… åˆè§„ |
| `/ask/detail/{id}` | æœªç¦æ­¢ | âœ… è®¿é—® | âœ… åˆè§„ |
| `/ask?page=2` | ç¦æ­¢ (`/*?*`) | âŒ ä¸ä½¿ç”¨ | âœ… åˆè§„ |
| `/login` | ç¦æ­¢ | âŒ ä¸è®¿é—® | âœ… åˆè§„ |
| `/reg/` | ç¦æ­¢ | âŒ ä¸è®¿é—® | âœ… åˆè§„ |

**ç»“è®º**: æœ¬çˆ¬è™«ä»…è®¿é—®æ˜ç¡®å…è®¸çš„å…¬å¼€é¡µé¢ï¼Œå®Œå…¨éµå®ˆ robots.txtã€‚

### 1.3 æŠ€æœ¯å®ç°

```python
# ä»£ç ä¸­çš„åˆè§„æ€§ä¿è¯
TARGET_ROOT = "https://m.ydl.com/ask"  # å…è®¸è®¿é—®
DETAIL_URL = f"https://m.ydl.com/ask/detail/{post_id}"  # å…è®¸è®¿é—®

# ä¸ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼ˆè¢« robots.txt ç¦æ­¢ï¼‰
# âŒ BAD: https://m.ydl.com/ask?page=2
# âœ… GOOD: https://m.ydl.com/ask
```

## 2. é™é€Ÿä¸ç¤¼è²ŒæŠ“å–

### 2.1 é»˜è®¤é™é€Ÿç­–ç•¥

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| QPS | 0.5 | æ¯2ç§’1ä¸ªè¯·æ±‚ |
| Burst | 2 | æœ€å¤š2ä¸ªå¹¶å‘ |
| é‡è¯•æ¬¡æ•° | 3 | å¤±è´¥åæœ€å¤šé‡è¯•3æ¬¡ |
| é€€é¿æ—¶é—´ | 1-60ç§’ | æŒ‡æ•°é€€é¿ |
| æŠ–åŠ¨ | 10-30% | éšæœºå»¶è¿Ÿ |

### 2.2 è®¾è®¡ç†å¿µ

1. **ä¿æŠ¤ç›®æ ‡ç«™ç‚¹**: é¿å…å¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›
2. **é•¿æœŸå¯æŒç»­**: ä¸ä¼šè§¦å‘é˜²æŠ¤æœºåˆ¶
3. **å°Šé‡èµ„æº**: ä»…åœ¨å¿…è¦æ—¶è®¿é—®
4. **å‹å¥½æ ‡è¯†**: ä½¿ç”¨çœŸå®çš„ User-Agent

### 2.3 è‡ªåŠ¨é™æµå“åº”

```python
# é‡åˆ°é™æµæ—¶è‡ªåŠ¨åœæ­¢
if response.status in [403, 429]:
    logger.critical("Rate limiting detected")
    await monitor.send_alert("Access restricted", severity="critical")
    # åœæ­¢æŠ“å–ï¼Œé¿å…åŠ é‡è´Ÿæ‹…
    return
```

## 3. æ•°æ®é‡‡é›†èŒƒå›´

### 3.1 é‡‡é›†å†…å®¹

âœ… **å…¬å¼€å¯è§æ•°æ®**:
- å¸–å­å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰
- ç”¨æˆ·æ˜µç§°ï¼ˆå…¬å¼€æ˜¾ç¤ºï¼‰
- è¯„è®ºå†…å®¹
- äº’åŠ¨æ•°æ®ï¼ˆé˜…è¯»æ•°ã€ç‚¹èµæ•°ï¼‰
- è¯é¢˜/åˆ†ç±»
- å‘å¸ƒæ—¶é—´
- å…¬å¼€å¤´åƒé“¾æ¥

### 3.2 ä¸é‡‡é›†å†…å®¹

âŒ **å—ä¿æŠ¤æ•°æ®**:
- éœ€è¦ç™»å½•æ‰èƒ½æŸ¥çœ‹çš„å†…å®¹
- ç”¨æˆ·éšç§ä¿¡æ¯ï¼ˆæ‰‹æœºå·ã€é‚®ç®±ã€åœ°å€ï¼‰
- ç§ä¿¡å†…å®¹
- ä»˜è´¹å†…å®¹
- è´¦å·å¯†ç 
- Session/Cookieï¼ˆä¸ä¿å­˜ï¼‰

### 3.3 æ•°æ®ä½¿ç”¨é™åˆ¶

âš ï¸ **ä½¿ç”¨çº¦æŸ**:
- ä»…ç”¨äºç ”ç©¶ã€åˆ†æã€å­¦ä¹ ç›®çš„
- ä¸ç”¨äºå•†ä¸šç”¨é€”ï¼ˆé™¤éè·å¾—æˆæƒï¼‰
- ä¸ç”¨äºéªšæ‰°ã€è·Ÿè¸ªç”¨æˆ·
- ä¸é‡æ–°å‘å¸ƒåˆ°å…¶ä»–å¹³å°
- å°Šé‡ç”¨æˆ·éšç§
- éµå®ˆæ•°æ®ä¿æŠ¤æ³•è§„

## 4. æ³•å¾‹æ³•è§„éµå®ˆ

### 4.1 ä¸­å›½æ³•å¾‹

**ã€Šç½‘ç»œå®‰å…¨æ³•ã€‹**:
- âœ… ä¸çªƒå–æˆ–éæ³•è·å–æ•°æ®
- âœ… ä¸ç ´åç½‘ç»œå®‰å…¨
- âœ… ä¸å¹²æ‰°æ­£å¸¸æœåŠ¡

**ã€Šæ•°æ®å®‰å…¨æ³•ã€‹**:
- âœ… åˆæ³•è·å–æ•°æ®
- âœ… å®‰å…¨å­˜å‚¨æ•°æ®
- âœ… ä¸æ³„éœ²ç”¨æˆ·éšç§

**ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹**:
- âœ… ä»…é‡‡é›†å…¬å¼€ä¿¡æ¯
- âœ… ä¸é‡‡é›†æ•æ„Ÿä¸ªäººä¿¡æ¯
- âœ… ä¸ç”¨äºéæ³•ç›®çš„

### 4.2 å›½é™…æ³•è§„

**GDPR (æ¬§ç›Ÿ)**:
- âœ… æ•°æ®æœ€å°åŒ–åŸåˆ™
- âœ… ç›®çš„é™åˆ¶åŸåˆ™
- âœ… å­˜å‚¨æœŸé™é™åˆ¶

**CCPA (åŠ å·)**:
- âœ… ä¸å‡ºå”®ä¸ªäººæ•°æ®
- âœ… é€æ˜å¤„ç†åŸåˆ™

## 5. é“å¾·å‡†åˆ™

### 5.1 æ ¸å¿ƒåŸåˆ™

1. **é€æ˜æ€§**: ä½¿ç”¨çœŸå® User-Agentï¼Œä¸ä¼ªè£…
2. **å°Šé‡æ€§**: éµå®ˆ robots.txt å’Œ ToS
3. **è´Ÿè´£æ€§**: å‡ºç°é—®é¢˜ç«‹å³åœæ­¢
4. **æœ€å°åŒ–**: åªé‡‡é›†å¿…è¦æ•°æ®
5. **å®‰å…¨æ€§**: å¦¥å–„å­˜å‚¨ï¼Œé˜²æ­¢æ³„éœ²

### 5.2 å®æ–½æªæ–½

```python
# 1. çœŸå®æ ‡è¯†
UA_MOBILE = "Mozilla/5.0 (iPhone...) [YDL-Scraper/1.0]"

# 2. é™é€Ÿä¿æŠ¤
QPS_LIMIT = 0.5  # éå¸¸ä¿å®ˆ

# 3. é”™è¯¯å“åº”
if error_rate > 0.1:
    logger.warning("High error rate, pausing...")
    await asyncio.sleep(300)  # æš‚åœ5åˆ†é’Ÿ

# 4. è‡ªåŠ¨å‘Šè­¦
await monitor.check_health(stats)  # å¼‚å¸¸æ—¶å‘Šè­¦å¹¶åœæ­¢
```

### 5.3 ç¦æ­¢è¡Œä¸º

âŒ **ä¸¥æ ¼ç¦æ­¢**:
- ä½¿ç”¨çˆ¬è™«è¿›è¡Œ DDoS æ”»å‡»
- ç»•è¿‡ç™»å½•éªŒè¯è·å–ç§å¯†ä¿¡æ¯
- å¤§è§„æ¨¡é«˜é¢‘æŠ“å–å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
- ç¯¡æ”¹æ•°æ®æˆ–æ³¨å…¥æ¶æ„å†…å®¹
- å°†æ•°æ®ç”¨äºéæ³•æ´»åŠ¨

## 6. æœåŠ¡æ¡æ¬¾ (ToS) åˆ†æ

### 6.1 å£¹ç‚¹çµç”¨æˆ·åè®®è¦ç‚¹

ï¼ˆåŸºäºå¸¸è§å¿ƒç†å’¨è¯¢å¹³å°æ¡æ¬¾ï¼Œå…·ä½“ä»¥å®˜ç½‘ä¸ºå‡†ï¼‰

| æ¡æ¬¾ | è¦æ±‚ | æœ¬çˆ¬è™«è¡Œä¸º |
|------|------|-----------|
| ä¸å¾—å¹²æ‰°æœåŠ¡ | ç¦æ­¢ç ´åç³»ç»Ÿ | âœ… é™é€Ÿè®¿é—®ï¼Œä¸å½±å“æœåŠ¡ |
| ä¿æŠ¤ç”¨æˆ·éšç§ | ä¸æ³„éœ²ä¸ªäººä¿¡æ¯ | âœ… ä»…é‡‡é›†å…¬å¼€ä¿¡æ¯ |
| å•†ä¸šç”¨é€”é™åˆ¶ | éœ€æˆæƒ | âš ï¸ ä»…ç ”ç©¶ç”¨é€” |
| å†…å®¹ç‰ˆæƒ | å±äºåŸä½œè€… | âœ… ä¿ç•™æ¥æºé“¾æ¥ |

### 6.2 ä½¿ç”¨å»ºè®®

1. **ç ”ç©¶ç”¨é€”**: å­¦æœ¯ç ”ç©¶ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ è®­ç»ƒ
2. **éœ€æˆæƒåœºæ™¯**: å•†ä¸šåˆ†æã€äº§å“å¼€å‘ã€å¯¹å¤–å‘å¸ƒ
3. **è”ç³»æ–¹å¼**: å¦‚éœ€å•†ä¸šä½¿ç”¨ï¼Œè¯·è”ç³»å£¹ç‚¹çµè·å–æˆæƒ

## 7. æŠ€æœ¯ä¿éšœæªæ–½

### 7.1 é˜²æ»¥ç”¨è®¾è®¡

```python
# 1. ç¡¬ç¼–ç é™é€Ÿ
QPS_LIMIT = 0.5  # ä¸å¯é€šè¿‡å‘½ä»¤è¡Œè¶…è¿‡ 2.0

# 2. å¼ºåˆ¶é€€é¿
if http_429_count > 3:
    sys.exit(1)  # å¼ºåˆ¶åœæ­¢

# 3. ç›‘æ§å‘Šè­¦
if success_rate < 0.5:
    await send_alert("Critical: High failure rate")
    sys.exit(1)
```

### 7.2 æ•°æ®å®‰å…¨

```python
# 1. æœ¬åœ°å­˜å‚¨ï¼ˆä¸ä¸Šä¼ åˆ°å…¬å¼€å¹³å°ï¼‰
DATA_DIR = "data/"  # æœ¬åœ°ç›®å½•

# 2. è®¿é—®æ§åˆ¶
os.chmod("data/", 0o700)  # ä»…æ‰€æœ‰è€…å¯è®¿é—®

# 3. æ•æ„Ÿä¿¡æ¯è„±æ•
if "phone" in content:
    content = re.sub(r'\d{11}', '***', content)
```

### 7.3 å®¡è®¡æ—¥å¿—

```python
# æ¯æ¬¡æŠ“å–è®°å½•è¯¦ç»†æ—¥å¿—
logger.info("scrape_started", 
    timestamp=datetime.now(),
    target=TARGET_ROOT,
    qps=QPS_LIMIT,
    mode=mode
)

# ä¿ç•™30å¤©æ—¥å¿—ç”¨äºå®¡è®¡
logs/
  2025-11-03.log
  2025-11-02.log
  ...
```

## 8. è´£ä»»å£°æ˜

### 8.1 å…è´£æ¡æ¬¾

1. **ä½¿ç”¨é£é™©**: ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨æœ¬å·¥å…·çš„é£é™©
2. **åˆè§„è´£ä»»**: ä½¿ç”¨è€…éœ€ç¡®ä¿ç¬¦åˆå½“åœ°æ³•å¾‹æ³•è§„
3. **æŸå®³èµ”å¿**: ä½œè€…ä¸å¯¹æ»¥ç”¨å¯¼è‡´çš„åæœè´Ÿè´£
4. **åŠæ—¶åœæ­¢**: å¦‚æ”¶åˆ°åœæ­¢é€šçŸ¥ï¼Œç«‹å³åœæ­¢ä½¿ç”¨

### 8.2 ä½œè€…æ‰¿è¯º

1. **å¼€æºé€æ˜**: ä»£ç å®Œå…¨å¼€æºï¼Œå¯å®¡è®¡
2. **æŠ€æœ¯è§„èŒƒ**: éµå¾ªæœ€ä½³å®è·µå’Œè¡Œä¸šæ ‡å‡†
3. **æŒç»­æ”¹è¿›**: æ ¹æ®åé¦ˆæ”¹è¿›åˆè§„æ€§
4. **ç¤¾åŒºè´¡çŒ®**: æ¥å—åˆè§„æ€§æ”¹è¿›å»ºè®®

### 8.3 è”ç³»ä¸åé¦ˆ

å¦‚æœæ‚¨æ˜¯å£¹ç‚¹çµçš„ä»£è¡¨ï¼Œå¯¹æœ¬å·¥å…·æœ‰ä»»ä½•ç–‘è™‘æˆ–å»ºè®®ï¼š

- ğŸ“§ æäº¤ GitHub Issue
- ğŸ“ å‘é€é‚®ä»¶è¯´æ˜æƒ…å†µ
- ğŸ›‘ æˆ‘ä»¬å°†ç«‹å³å“åº”å¹¶é‡‡å–è¡ŒåŠ¨

## 9. åˆè§„æ€§æ£€æŸ¥æ¸…å•

ä½¿ç”¨å‰è¯·ç¡®è®¤ï¼š

- [ ] å·²é˜…è¯»å¹¶ç†è§£ robots.txt
- [ ] å·²é˜…è¯»ç›®æ ‡ç½‘ç«™æœåŠ¡æ¡æ¬¾
- [ ] ç¡®è®¤ä»…ç”¨äºåˆæ³•ç›®çš„
- [ ] å·²è®¾ç½®åˆç†çš„é™é€Ÿå‚æ•°
- [ ] é…ç½®äº†å‘Šè­¦ç›‘æ§
- [ ] æœ¬åœ°å®‰å…¨å­˜å‚¨æ•°æ®
- [ ] ä¸ä¼šå°†æ•°æ®ç”¨äºéæ³•ç”¨é€”
- [ ] é‡åˆ°é—®é¢˜ä¼šç«‹å³åœæ­¢

## 10. æ›´æ–°è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´ |
|------|------|------|
| 2025-11-03 | 1.0 | åˆå§‹ç‰ˆæœ¬ |

---

**é‡è¦æç¤º**: æœ¬æ–‡æ¡£ä¼šéšç€æ³•è§„å˜åŒ–å’Œç½‘ç«™æ”¿ç­–æ›´æ–°è€Œæ›´æ–°ã€‚ä½¿ç”¨å‰è¯·ç¡®ä¿é˜…è¯»æœ€æ–°ç‰ˆæœ¬ã€‚

**é“å¾·å£°æ˜**: æŠ€æœ¯æ˜¯ä¸­æ€§çš„ï¼Œä½†ä½¿ç”¨æŠ€æœ¯çš„æ–¹å¼å†³å®šäº†å…¶ä»·å€¼ã€‚è¯·è´Ÿè´£ä»»åœ°ä½¿ç”¨æœ¬å·¥å…·ï¼Œä¸ºæ„å»ºæ›´å¥½çš„äº’è”ç½‘ç¯å¢ƒè´¡çŒ®åŠ›é‡ã€‚

